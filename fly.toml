# fly.toml app configuration file for IKANN (Custom DNS on port 1053)
# Updated for non-HTTP CoreDNS deployment via Fly.io

app = 'ikann'
primary_region = 'iad'

# No build section needed unless using a buildpack or builder

[build]
# Leave empty if using Dockerfile directly (Fly uses Dockerfile by default if present)

[env]
PORT = "1053"

# Disable the default HTTP service block (you are not serving HTTP traffic)
# Instead, use raw TCP/UDP port exposure via [[services]]
# This lets your CoreDNS run directly on port 1053

[[services]]
  protocol = "tcp"
  internal_port = 1053
  ports = [
    { port = 1053 }  # Expose port 1053 to the public
  ]

  [services.concurrency]
    type = "connections"
    hard_limit = 25
    soft_limit = 20

[[vm]]
  memory = "1gb"
  cpu_kind = "shared"
  cpus = 1
